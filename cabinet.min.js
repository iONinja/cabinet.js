/*
 * Cabinet.js
 * Automatically keeps variables synced to storage in the browser or Node.js
 *
 * v0.0.2
 * 4 December, 2017
 *
 * By iO Ninja
 * MIT license
 * See README.md for more information
 */

/*
 * object.watch polyfill
 *
 * 2012-04-03
 *
 * By Eli Grey, http://eligrey.com
 * Public Domain.
 * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
 */

Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c;delete this[a]&&Object.defineProperty(this,a,{get:function(){return d},set:function(h){return c=d,d=b.call(this,a,c,h)},enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a],this[a]=b}});var _node="undefined"!=typeof module&&module.exports;if(_node){var path=require("path"),LocalStorage=require("node-localstorage").LocalStorage;localStorage=new LocalStorage(path.join(path.dirname(module.parent.filename),"localStorage"))}cabinet={_load:function(){_node?this.node={new:!0}:(this.site={new:!0},this.page={new:!0});var a=localStorage.getItem("cabinet");if(null!=a){var b=JSON.parse(a);this._pages=b.pages,this._globals=b.globals,_node?this.new=!1:this.site.new=!1}else this._save();_node||(this._path=window.location.pathname,this._path in this._pages?this.page.new=!1:this._pages[this._path]={})},_save:function(){localStorage.setItem("cabinet",JSON.stringify({pages:this._pages,globals:this._globals}))},_pages:{},_globals:{},_path:"/",site:null,page:null,node:null,sync:function(){var a=null;a=_node||!0==arguments[arguments.length-1]?this._globals:this._pages[this._path];for(var c,b=0;b<arguments.length;b++){if(c=arguments[b],c){var d;d=_node?global:window,void 0==a[c]?a[c]=d[c]:d[c]=a[c]}this._save(),d.watch(c,function(e,f,h,j){return f in e&&(e[f]=j,this._save()),j}.bind(this,a))}},wipe:function(a){_node||!0==a?(this._pages={},this._globals={},this.site.new=!0,this.page.new=!0,localStorage.removeItem("cabinet")):(delete this._pages[this._path],this._save())}},cabinet._load(),_node&&(module.exports=cabinet);
